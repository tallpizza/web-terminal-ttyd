<!DOCTYPE html>
<html>
<head>
    <title>ttyd Test</title>
    <link rel="stylesheet" href="https://unpkg.com/xterm@5.3.0/css/xterm.css" />
    <style>
        body { margin: 0; padding: 20px; background: #222; }
        #terminal { width: 100%; height: 500px; }
        button { margin: 10px; padding: 10px; font-size: 16px; }
    </style>
</head>
<body>
    <h1 style="color: white;">ttyd Terminal Test</h1>
    <button onclick="testLS()">Test 'ls' Command</button>
    <button onclick="testVirtualKeyboard()">Test Virtual Keyboard Input</button>
    <div id="terminal"></div>
    
    <script src="https://unpkg.com/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://unpkg.com/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    
    <script>
        // Initialize terminal
        const term = new Terminal({
            cursorBlink: true,
            fontSize: 14,
            theme: {
                background: '#000000',
                foreground: '#ffffff'
            }
        });
        
        const fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);
        term.open(document.getElementById('terminal'));
        fitAddon.fit();
        
        // Connect directly to ttyd on port 8082
        const ws = new WebSocket('ws://localhost:8082/ws');
        ws.binaryType = 'arraybuffer';
        
        ws.onopen = () => {
            console.log('Connected to ttyd');
            term.write('Connected to ttyd!\r\n');
        };
        
        ws.onmessage = (event) => {
            if (event.data instanceof ArrayBuffer) {
                const text = new TextDecoder().decode(event.data);
                term.write(text);
            }
        };
        
        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
            term.write('\r\n[Error] Connection failed\r\n');
        };
        
        ws.onclose = () => {
            term.write('\r\n[Disconnected]\r\n');
        };
        
        // Send input to ttyd
        term.onData((data) => {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(data);
            }
        });
        
        // Test functions
        function testLS() {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send('ls\r');
                console.log('Sent: ls command');
            } else {
                alert('Not connected to terminal');
            }
        }
        
        function testVirtualKeyboard() {
            const text = prompt('Enter text to send:');
            if (text && ws.readyState === WebSocket.OPEN) {
                ws.send(text);
                console.log('Sent:', text);
            }
        }
    </script>
</body>
</html>